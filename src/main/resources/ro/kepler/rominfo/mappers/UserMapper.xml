<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ro.kepler.rominfo.mappers.UserMapper">

    <resultMap type="User" id="UserResult">
        <id property="userId" column="userid"/>
        <result property="firstName" column="firstname"/>
        <result property="lastName" column="lastname"/>
        <result property="ssn" column="ssn"/>
        <result property="email" column="email"/>
        <result property="password" column="password"/>
        <result property="role" column="role"/>
        <discriminator javaType="java.lang.String" column="role">
            <case value="Professor" resultMap="ProfessorResult"/>
            <case value="Student" resultMap="StudentResult"/>
        </discriminator>
    </resultMap>

    <resultMap type="Professor" id="ProfessorResult" extends="UserResult">
        <result property="entitling" column="entitling"/>
        <result property="department" column="department"/>
    </resultMap>

    <resultMap type="Student" id="StudentResult" extends="UserResult">
        <result property="yearOfStudy" column="yearofstudy"/>
        <result property="specialization" column="specialization"/>
    </resultMap>

    <select id="getAllUsers" resultMap="UserResult">
        SELECT u."userid" AS userId,
        u."firstname" AS firstName,
        u."lastname" AS lastName,
        u."ssn" AS ssn,
        u."email" AS email,
        u."password" AS password,
        u."role" AS role
        FROM public."user" u
    </select>

    <select id="getUserById" resultMap="UserResult">
        SELECT u."userid" AS userId,
        u."firstname" AS firstName,
        u."lastname" AS lastName,
        u."ssn" AS ssn,
        u."email" AS email,
        u."password" AS password,
        u."role" AS role
        FROM public."user" u
        WHERE u.userid=#{userId}
    </select>

    <insert id = "addProfessorUser">
        insert into "professor" (email, password, firstname, lastname, ssn, role)
        VALUES (#{email},#{password},#{firstName},#{lastName},#{ssn},#{role});
    </insert>

    <insert id = "addStudentUser">
        insert into "student" (email, password, firstname, lastname, ssn, role)
        VALUES (#{email},#{password},#{firstName},#{lastName},#{ssn},#{role});
    </insert>

    <select id="findByEmail" resultMap="UserResult">
        SELECT u."userid" AS userId,
               u."firstname" AS firstName,
               u."lastname" AS lastName,
               u."ssn" AS ssn,
               u."email" AS email,
               u."password" AS password,
               u."role" AS role
        FROM public."user" u
        WHERE u."email"=#{email}
    </select>


</mapper>